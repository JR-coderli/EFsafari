# Clickflare API 配置
api:
  base_url: "https://public-api.clickflare.io"
  endpoint: "/api/report"
  api_key: "406561a67ff45389757647c936537da98f6c89a11776566dbe6efc8241c357f9.da59c8abbd8fbf4af7c3a5c72612d871a30273fa"
  timezone: "UTC"

# 重试配置
retry:
  max_attempts: 3
  backoff_factor: 2
  retry_status_codes: [500, 502, 503, 504]

# Poll 配置（用于 MTG API）
poll:
  max_attempts: 20
  interval_seconds: 15
  timeout_seconds: 300

# ClickHouse 配置
clickhouse:
  host: "43.160.248.9"
  port: 8123
  database: "ad_platform"
  table: "dwd_marketing_report_daily"
  username: "default"
  password: "admin123"
  secure: false

# ETL 配置
etl:
  media_source: "Clickflare"
  batch_size: 10000
  date_offset_days: 1  # 1 = 昨天, 0 = 今天
  page_size: 1000
  max_pages: 100

  # API 分组维度（最多10个）
  group_by:
    - "date"
    - "trafficSourceID"
    - "offerID"
    - "affiliateNetworkID"
    - "trackingField1"
    - "trackingField2"
    - "trackingField3"
    - "trackingField4"
    - "trackingField5"
    - "trackingField6"

  # 第二次拉取：用 landingID 替换 affiliateNetworkID
  group_by_pass2:
    - "date"
    - "trafficSourceID"
    - "offerID"
    - "landingID"
    - "trackingField1"
    - "trackingField2"
    - "trackingField3"
    - "trackingField4"
    - "trackingField5"
    - "trackingField6"

  # API 指标（所有字段都不带 cm_ 前缀）
  metrics:
    - "trafficSourceName"
    - "offerName"
    - "affiliateNetworkName"
    - "uniqueVisits"
    - "uniqueClicks"
    - "conversions"
    - "revenue"
    - "cost"

  # 第二次拉取的指标（获取 landingName）
  metrics_pass2:
    - "landingName"

  # 不拉取 spend 的媒体（这些媒体有其他 API 安排）
  exclude_spend_media:
    - "Mintegral"
    - "Hastraffic"

  # MTG 数据集成配置
  # 在 CF ETL 中同时拉取并合并 MTG spend 数据
  mtg_integration:
    enabled: true  # 是否启用 MTG 数据集成
    api_base_url: "https://ss-api.mintegral.com"
    api_endpoint: "/api/v2/reports/data"
    api_timezone: "0"
    dimension_option: "Offer,Campaign,Creative"
    time_granularity: "daily"

    # MTG 账户配置
    accounts:
      - name: "Account1"
        access_key: "28e3b671a1c06171448e85233b65e0e0"
        api_key: "25e8f524265bb39fa0521ea7f72924e4"
      - name: "Account2"
        access_key: "00c6e1387b44dc94d5d7df4256ed07eb"
        api_key: "ea70b2e328b7c11b1ecec66dea2d1a49"
      - name: "Account3"
        access_key: "e0c55f0bc62515cfbb08c21d98ca7776"
        api_key: "1c23a2044c0dac36cf7a0671e075c3d9"

    # 需要合并 MTG spend 的媒体关键词
    mtg_media_keywords:
      - "Mintegral"
      - "Hastraffic"

# 日志配置
logging:
  level: "INFO"
  log_dir: "logs"
  log_file: "cf_etl.log"
  max_bytes: 10485760  # 10MB
  backup_count: 5
